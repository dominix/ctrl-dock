<?phpheader('Content-Type:text/xml');echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?>";// This API is used to list the last known status and ping statistics of the hosts' network interface// hosts_nw_status.php?key=abcd&hostname=server.domain.comfunction invalid(){	echo "<node>";		echo "<count>invalid</count>";	echo "</node>";	die(0);}function success($count){	echo "<node>";		echo "<count>".$count."</count>";	echo "</node>";	die(0);}function showxml($result, $num_rows){	if($num_rows>0){		echo "<node>";		while($row = mysql_fetch_array($result)){					echo "<status>";				echo "<host_id><![CDATA[".$row[0]."]]></host_id>";				echo "<nw_snmp_cpu_status><![CDATA[".$row[1]."]]></nw_snmp_cpu_status>";				echo "<nw_snmp_mem_status><![CDATA[".$row[2]."]]></nw_snmp_mem_status>";				echo "<cpu_user><![CDATA[".$row[3]."]]></cpu_user>";				echo "<cpu_system><![CDATA[".$row[4]."]]></cpu_system>";				echo "<cpu_idle><![CDATA[".$row[5]."]]></cpu_idle>";									echo "<timestamp><![CDATA[".$row[6]."]]></timestamp>";				echo "<mem_utilization><![CDATA[".$row[7]."]]></mem_utilization>";				echo "<nw_snmp_dsk_status><![CDATA[".$row[8]."]]></nw_snmp_dsk_status>";				echo "<disk_utilization><![CDATA[".$row[9]."]]></disk_utilization>";			echo "</status>";		}			echo "</node>";		}else{			$nodata = 0;			success($nodata);		}	}// include config file, also contains the API KEYrequire_once('../include/config.php');require_once('../include/db.php');$api_key		= strip_tags($_REQUEST['key']);$hostname		= strip_tags($_REQUEST['hostname']);$num_rows		= '';// validate api keyif($api_key!=$API_KEY || $api_key==''){	invalid();}else{		$sql = "SELECT a.host_id,b.nw_snmp_cpu_status,b.nw_snmp_mem_status,b.cpu_user,b.cpu_system,b.cpu_idle,b.timestamp,b.mem_utilization,b.nw_snmp_dsk_status,b.disk_utilization FROM hosts_master a,hosts_nw_snmp_log b WHERE a.host_id=b.host_id AND a.hostname='$hostname' ORDER BY b.record_id DESC LIMIT 1";		$result = mysql_query($sql);			$num_rows = mysql_num_rows($result);		showxml($result, $num_rows);		}?>